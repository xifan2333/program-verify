import{d as f,u as y,e as c,h as v,o as h,k as t,p as w,j as m,q as g,t as k}from"./vendor-CFUBHfbh.js";import{r as x,u as b}from"./index-DmvhG2uU.js";const S="http://localhost:8080/api/v1";async function u(o,s={}){const r=localStorage.getItem("token"),n={headers:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{},...s.headers||{}},...s};try{const l=await(await fetch(`${S}${o}`,n)).json();return l.status===401?(localStorage.removeItem("token"),x.replace("/login"),b().error("登录已过期，请重新登录"),Promise.reject(new Error("Unauthorized"))):l}catch(a){return console.error("请求错误:",a),Promise.reject(a)}}const _={get:(o,s)=>u(o,{...s,method:"GET"}),post:(o,s,r)=>u(o,{...r,method:"POST",body:JSON.stringify(s)}),put:(o,s,r)=>u(o,{...r,method:"PUT",body:JSON.stringify(s)}),delete:(o,s)=>u(o,{...s,method:"DELETE"})},E={class:"min-h-screen flex-center bg-gray-100 dark:bg-gray-900"},T={class:"w-96 p-8 bg-white dark:bg-gray-800 rounded-lg shadow-lg"},j={class:"mt-4"},B={class:"mt-4"},U=["disabled"],P=f({__name:"Login",setup(o){const s=y(),r=b(),n=c(""),a=c(""),l=c(!1),p=async()=>{if(!n.value||!a.value){r.warning("请输入用户名和密码");return}l.value=!0;try{const{status:d,message:e,data:i}=await _.post("/auth/login",{username:n.value,password:a.value});d===200?(localStorage.setItem("token",i.token),r.success(e),s.replace("/")):r.error(e||"登录失败")}catch(d){console.error("登录错误:",d),r.error("登录失败，请稍后重试")}finally{l.value=!1}};return(d,e)=>(h(),v("div",E,[t("div",T,[e[4]||(e[4]=t("div",{class:"text-center mb-8"},[t("div",{class:"flex-center gap-3 mb-4"},[t("div",{class:"i-ri-key-2-line text-4xl text-primary"}),t("h1",{class:"text-2xl font-bold"},"软件授权管理系统")])],-1)),t("form",{onSubmit:w(p,["prevent"]),class:"space-y-4"},[t("div",j,[e[2]||(e[2]=t("label",{class:"block text-sm font-medium mb-2"},"用户名",-1)),m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>n.value=i),type:"text",class:"w-full px-4 py-2 rounded-lg border dark:border-gray-700 bg-white dark:bg-gray-900",placeholder:"请输入用户名",required:""},null,512),[[g,n.value]])]),t("div",B,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium mb-2"},"密码",-1)),m(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>a.value=i),type:"password",class:"w-full px-4 py-2 rounded-lg border dark:border-gray-700 bg-white dark:bg-gray-900",placeholder:"请输入密码",required:""},null,512),[[g,a.value]])]),t("button",{type:"submit",class:"w-full btn-primary mt-4",disabled:l.value},k(l.value?"登录中...":"登录"),9,U)],32)])]))}});export{P as default};
